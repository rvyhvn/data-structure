#include <limits.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#include "../lib/sorting.h"
#include "../lib/structure.h"

void printArray(int arr[], int size) {
  for (int count = 0; count < size; count++) {
    printf("%d", arr[count]);
    if (count != size - 1) {
      printf(", ");
    }
  }
  printf("\n");
}

void printBag(Bag *bag) {
  for (int count = 0; count < bag->count; count++) {
    printf("%d", bag->items[count]);
    if (count != bag->count - 1) {
      printf(", ");
    }
  }
  printf("\n");
}

void printQueue(Queue *queue) {
  for (int i = queue->front; i <= queue->rear; i++) {
    printf("%d", queue->items[i]);
    if (i != queue->rear) {
      printf(", ");
    }
  }
  printf("\n");
}

int main(int argc, char *argv[]) {

  if (argc < 2) {
    printf("Usage: %s <command> [options]\n", argv[0]);
    printf("Commands: stack, bags, queue, sort, linkedlist\n");
    return 1;
  }

  if (strcmp(argv[1], "stack") == 0) {
    if (argc < 4) {
      printf("Usage: %s stack <operation> <filename> [value]\n", argv[0]);
      return 1;
    }

    Stack tempStack;
    initStack(&tempStack);

    const char *filename = argv[3];
    if (!loadStackState(&tempStack, filename)) {
      initStack(&tempStack);
    }

    if (strcmp(argv[2], "push") == 0 && argc == 5) {
      int value = atoi(argv[4]);
      pushStack(&tempStack, value);
    } else if (strcmp(argv[2], "pop") == 0 && argc == 4) {
      int value = popStack(&tempStack);
      if (value != INT_MIN) {
        printf("Popped value from Stack: %d\n", value);
      } else {
        printf("Stack is empty.\n");
      }
    } else if (strcmp(argv[2], "is_full") == 0 && argc == 4) {
      bool isFull = isStackFull(&tempStack);
      printf("Is Stack full? %s\n", isFull ? "Yes" : "No");
    } else if (strcmp(argv[2], "is_empty") == 0 && argc == 4) {
      bool isEmpty = isStackEmpty(&tempStack);
      printf("Is Stack empty? %s\n", isEmpty ? "Yes" : "No");
    } else {
      printf("Invalid operation\n");
      return 1;
    }

    saveStackState(&tempStack, filename);
  } else if (strcmp(argv[1], "bags") == 0) {
    if (argc < 4) {
      printf("Usage: %s bags <operation> <filename> [value]\n", argv[0]);
      return 1;
    }

    Bag tempBag;
    initBag(&tempBag);

    const char *filename = argv[3];
    if (!loadBagState(&tempBag, filename)) {
      initBag(&tempBag);
    }

    if (strcmp(argv[2], "push") == 0 && argc == 5) {
      int value = atoi(argv[4]);
      insertToBag(&tempBag, value);
    } else if (strcmp(argv[2], "pop") == 0 && argc == 5) {
      int value = atoi(argv[4]);
      int removedValue = removeFromBag(&tempBag, value);
      if (removedValue != INT_MIN) {
        printf("Removed value from Bag: %d\n", removedValue);
      } else {
        printf("Value not found in the Bag.\n");
      }
    } else {
      printf("Invalid operation\n");
      return 1;
    }

    saveBagState(&tempBag, filename);

  } else if (strcmp(argv[1], "queue") == 0) {

    if (argc < 4) {
      printf("Usage: %s queue <operation> <filename> [value]\n", argv[0]);
      return 1;
    }

    Queue tempQueue;
    initQueue(&tempQueue);

    const char *filename = argv[3];
    if (!loadQueueState(&tempQueue, filename)) {
      initQueue(&tempQueue);
    }

    if (strcmp(argv[2], "enqueue") == 0 && argc == 5) {
      int value = atoi(argv[4]);
      enqueue(&tempQueue, value);
    } else if (strcmp(argv[2], "dequeue") == 0 && argc == 4) {
      int value = dequeue(&tempQueue);
      if (value != INT_MIN) {
        printf("Dequeued value from Queue: %d\n", value);
      } else {
        printf("Queue is empty.\n");
      }
    } else if (strcmp(argv[2], "is_full") == 0 && argc == 4) {
      bool isFull = isQueueFull(&tempQueue);
      printf("Is Queue full? %s\n", isFull ? "Yes" : "No");
    } else if (strcmp(argv[2], "is_empty") == 0 && argc == 4) {
      bool isEmpty = isQueueEmpty(&tempQueue);
      printf("Is Queue empty? %s\n", isEmpty ? "Yes" : "No");
    } else {
      printf("Invalid operation.\n");
      return 1;
    }

    saveQueueState(&tempQueue, filename);
  } else if (strcmp(argv[1], "sort") == 0) {
    int arr[] = {
        332, 805, 413, 831, 584, 458, 405, 966, 464, 633, 823, 448, 162, 512,
        632, 16,  180, 662, 723, 342, 684, 420, 885, 16,  129, 610, 110, 966,
        800, 193, 758, 484, 999, 171, 315, 935, 982, 72,  901, 798, 706, 725,
        246, 868, 589, 230, 884, 121, 244, 607, 463, 928, 379, 700, 945, 508,
        663, 407, 474, 463, 601, 233, 300, 952, 756, 967, 887, 738, 40,  788,
        536, 746, 865, 134, 614, 454, 717, 850, 575, 961, 809, 390, 890, 188,
        91,  187, 696, 754, 594, 523, 569, 547, 108, 869, 499, 216, 837, 386,
        307, 229, 527, 195, 975, 744, 330, 941, 551, 399, 791, 478, 360, 952,
        869, 250, 492, 312, 437, 540, 418, 384, 63,  339, 931, 523, 209, 431,
        740, 398, 169, 399, 627, 48,  594, 954, 793, 276, 895, 344, 675, 38,
        822, 36,  342, 43,  286, 834, 355, 76,  374, 125, 460, 790, 465, 743,
        665, 26,  526, 757, 424, 48,  156, 403, 96,  751, 709, 889, 27,  956,
        585, 703, 346, 760, 91,  688, 803, 729, 522, 511, 805, 248, 636, 617,
        390, 101, 713, 56,  127, 239, 813, 903, 287, 970, 658, 384, 721, 719,
        625, 100, 675, 563, 155, 21,  323, 246, 709, 126, 976, 583, 637, 133,
        184, 274, 103, 574, 727, 816, 630, 207, 55,  444, 110, 695, 766, 121,
        431, 487, 840, 408, 939, 516, 971, 95,  889, 294, 693, 951, 421, 21,
        886, 410, 507, 70,  36,  610, 645, 764, 778, 627, 323, 185, 423, 433,
        880, 189, 906, 663, 28,  747, 72,  968, 615, 43,  415, 856, 338, 460,
        807, 111, 834, 694, 873, 341, 116, 910, 303, 113, 26,  81,  741, 701,
        266, 164, 134, 499, 706, 393, 162, 734, 492, 234, 702, 459, 630, 117,
        315, 320, 930, 475, 783, 764, 521, 656, 457, 637, 918, 760, 103, 296,
        841, 196, 997, 459, 712, 484, 958, 418, 877, 473, 153, 369, 59,  207,
        180, 689, 677, 495, 9,   607, 322, 792, 371, 843, 801, 828, 833, 719,
        940, 936, 16,  133, 132, 365, 592, 196, 849, 903, 615, 78,  376, 120,
        799, 435, 327, 979, 477, 4,   475, 486, 611, 149, 631, 334, 993, 432,
        162, 826, 503, 454, 114, 519, 587, 598, 237, 180, 794, 86,  435, 761,
        165, 163, 881, 964, 950, 209, 296, 427, 213, 771, 266, 177, 272, 897,
        511, 265, 681, 26,  443, 184, 480, 909, 56,  68,  507, 293, 600, 654,
        379, 387, 767, 896, 550, 649, 213, 500, 210, 509, 928, 423, 632, 546,
        600, 904, 443, 464, 522, 476, 490, 965, 660, 970, 875, 716, 390, 734,
        361, 990, 740, 93,  729, 508, 989, 279, 509, 554, 780, 719, 63,  60,
        494, 47,  606, 447, 952, 401, 911, 826, 877, 753, 791, 537, 723, 18,
        606, 466, 105, 967, 808, 197, 60,  538, 705, 402, 817, 566, 956, 949,
        285, 372, 361, 132, 771, 967, 931, 75,  720, 842, 901, 597, 595, 45,
        487, 670, 63,  445, 136, 520, 764, 297, 718, 177, 835, 775, 931, 4,
        342, 887, 954, 979, 611, 315, 463, 383, 635, 394, 810, 355, 236, 712,
        305, 183, 757, 144, 206, 172, 589, 694, 693, 705, 991, 411, 882, 826,
        538, 813, 183, 880, 53,  137, 212, 16,  804, 675, 751, 439, 70,  562,
        147, 658, 274, 452, 842, 383, 596, 48,  555, 537, 94,  248, 242, 86,
        11,  477, 264, 902, 290, 447, 782, 343, 936, 346, 712, 741, 22,  463,
        180, 92,  25,  679, 750, 651, 131, 944, 34,  79,  344, 590, 968, 439,
        190, 211, 877, 554, 688, 141, 456, 330, 589, 590, 26,  877, 937, 738,
        618, 311, 201, 151, 755, 227, 830, 857, 878, 314, 802, 265, 745, 498,
        855, 714, 289, 397, 277, 166, 951, 965, 308, 759, 647, 249, 702, 673,
        126, 991, 411, 745, 302, 613, 248, 57,  192, 78,  266, 422, 744, 420,
        687, 490, 919, 894, 204, 208, 292, 481, 375, 595, 798, 35,  707, 445,
        284, 409, 119, 410, 400, 882, 507, 54,  847, 755, 463, 39,  186, 729,
        462, 930, 150, 501, 420, 421, 396, 624, 629, 40,  457, 356, 987, 255,
        391, 46,  53,  675, 807, 172, 438, 207, 406, 945, 613, 254, 701, 76,
        293, 239, 158, 107, 169, 308, 961, 590, 81,  709, 566, 710, 101, 24,
        419, 88,  631, 810, 135, 684, 838, 942, 208, 276, 502, 615, 573, 467,
        869, 626, 896, 514, 865, 54,  974, 35,  714, 935, 977, 795, 644, 543,
        857, 745, 567, 628, 185, 551, 439, 672, 235, 629, 967, 444, 905, 821,
        59,  830, 288, 280, 457, 184, 146, 322, 590, 120, 709, 304, 55,  686,
        451, 699, 230, 661, 796, 149, 289, 982, 700, 80,  654, 936, 709, 621,
        732, 966, 442, 143, 797, 83,  423, 254, 619, 569, 928, 210, 690, 638,
        866, 97,  676, 318, 149, 906, 979, 945, 408, 620, 279, 460, 701, 934,
        748, 410, 907, 480, 377, 702, 623, 174, 137, 398, 780, 756, 320, 708,
        966, 362, 698, 185, 459, 375, 503, 960, 633, 834, 258, 41,  454, 537,
        854, 155, 823, 602, 918, 83,  435, 295, 137, 410, 821, 274, 809, 601,
        30,  481, 661, 349, 195, 712, 534, 654, 87,  389, 967, 72,  575, 225,
        114, 381, 762, 320, 537, 586, 922, 807, 21,  357, 454, 158, 120, 275,
        432, 281, 228, 814, 762, 241, 515, 957, 953, 401, 963, 392, 790, 930,
        465, 365, 507, 931, 747, 270, 251, 636, 208, 525, 795, 229, 235, 249,
        387, 355, 524, 171, 636, 104, 985, 750, 697, 501, 707, 651, 902, 22,
        395, 45,  305, 212, 762, 812, 143, 509, 82,  746, 497, 642, 624, 644,
        223, 859, 893, 610, 214, 769, 781, 202, 873, 119, 952, 571, 620, 11,
        574, 874, 33,  321, 919, 338, 534, 682, 151, 29,  543, 585, 776, 393,
        580, 400, 37,  803, 611, 931, 766, 177, 700, 899, 379, 926, 18,  683,
        849, 638, 694, 775, 513, 79,  96,  784, 418, 630, 466, 921, 12,  10,
        858, 788, 403, 438, 540, 440, 594, 151, 723, 360, 328, 776, 259, 59,
        702, 630, 742, 903, 620, 788, 678, 133, 867, 126, 270, 637, 109, 736,
        910, 121, 746, 121, 909, 501, 911, 801, 294, 505, 304, 17,  217, 984,
        793, 829, 43,  847, 459, 137, 102, 79,  925, 780, 565, 144, 259, 835,
        134, 368, 571, 44,  489, 670, 165, 750, 171, 77,  551, 817, 934, 207,
        835, 152, 191, 980, 981, 234, 828, 440, 723, 930, 519, 0,   63,  436,
        144, 322, 271, 630, 42,  843, 27,  531, 513, 544, 281, 36,  973, 184,
        854, 908, 391, 41,  60,  582, 21,  393, 168, 201, 185, 243, 484, 56,
        243, 899, 493, 739, 573, 764, 370, 615, 959, 397, 146, 824, 941, 779,
        861, 915, 315, 67,  175, 706, 108, 587, 640, 481, 980, 160, 35,  165,
        403, 519, 573, 646, 770, 66,  737, 343, 831, 107, 958, 790, 856, 456,
        615, 150, 235, 828, 65,  550, 247, 240, 608, 707, 827, 600, 188, 159,
        760, 223, 676, 515, 94,  249, 513, 864, 316, 250, 559, 499, 710, 517,
        641, 566, 973, 608, 716, 560, 788, 133, 462, 35,  725, 70,  94,  904,
        670, 283, 415, 782, 858, 91,  297, 305, 693, 810, 521, 361, 413, 81,
        860, 123, 950, 853, 41,  276, 814, 758, 836, 602, 243, 299, 990, 969,
        721, 84,  225, 392, 719, 641, 174, 930, 732, 824, 235, 425, 634, 108,
        786, 47,  189, 998, 522, 492, 204, 564, 768, 18,  674, 956, 972, 917,
        255, 962, 238, 329, 399, 464, 721, 470, 105, 247, 400, 189, 71,  987,
        967, 58,  96,  105, 457, 285, 456, 980, 777, 660, 896, 897, 30,  570,
        854, 2,   839, 461, 317, 78,  790, 68,  894, 863, 538, 351, 111, 939,
        540, 182, 926, 859, 240, 22,  965, 698, 660, 773, 30,  789, 433, 926,
        39,  815, 496, 893, 817, 335, 354, 486, 765, 497, 554, 659, 360, 93,
        10,  471, 384, 903, 6,   662, 762, 598, 37,  79,  648, 49,  204, 678,
        838, 989, 604, 229, 804, 452, 122, 974, 140, 829, 460, 905, 326, 367,
        917, 38,  812, 927, 862, 196, 182, 220, 858, 297, 818, 247, 728, 467,
        296, 933, 497, 487, 922, 102, 716, 727, 906, 839, 53,  398, 20,  513,
        304, 698, 232, 573, 736, 44,  852, 950, 240, 35,  170, 451, 332, 989,
        698, 60,  808, 995, 345, 305, 834, 268, 759, 550, 347, 666, 389, 400,
        64,  761, 265, 720, 459, 498, 293, 548, 894, 146, 498, 135, 533, 669,
        938, 217, 658, 988, 629, 466, 335, 975, 771, 169, 595, 883, 720, 942,
        549, 461, 694, 965, 223, 311, 38,  34,  161, 683, 582, 56,  829, 81,
        543, 714, 750, 481, 931, 408, 469, 561, 226, 805, 536, 349, 326, 131,
        232, 46,  425, 133, 508, 471, 99,  83,  782, 489, 117, 296, 172, 700,
        352, 354, 781, 895, 68,  883, 728, 0,   643, 549, 913, 869, 706, 449,
        218, 33,  932, 803, 79,  709, 936, 939, 180, 387, 374, 314, 876, 492,
        610, 401, 544, 314, 755, 677, 561, 823, 560, 289, 175, 203, 839, 88,
        424, 545, 889, 994, 930, 173, 797, 10,  882, 86,  301, 414, 473, 676,
        729, 702, 520, 691, 103, 64,  358, 210, 93,  919, 385, 653, 561, 561,
        208, 400, 1,   632, 297, 243, 978, 580, 416, 776, 590, 651, 214, 243,
        65,  39,  919, 146, 741, 439, 190, 196, 855, 548, 406, 948, 467, 792,
        953, 28,  705, 161, 780, 58,  145, 430, 653, 476, 10,  70,  252, 952,
        73,  818, 195, 138, 857, 467, 637, 599, 258, 827, 147, 466, 375, 554,
        414, 194, 698, 720, 223, 755, 233, 355, 165, 731, 137, 819, 207, 147,
        889, 811, 451, 314, 629, 647, 452, 486, 466, 441, 437, 76,  268, 585,
        542, 995, 491, 309, 190, 541, 29,  765, 296, 614, 120, 461, 345, 258,
        632, 552, 757, 873, 363, 209, 187, 992, 208, 640, 831, 674, 81,  268,
        750, 702, 853, 645, 697, 696, 954, 887, 237, 335, 652, 533, 949, 125,
        347, 295, 383, 979, 847, 492, 853, 563, 701, 40,  907, 909, 32,  738,
        935, 466, 7,   38,  520, 212, 683, 217, 261, 989, 457, 498, 324, 109,
        384, 273, 586, 731, 920, 321, 62,  768, 814, 267, 683, 515, 660, 590,
        777, 692, 329, 64,  510, 688, 102, 30,  252, 137, 248, 513, 478, 57,
        364, 802, 166, 748, 428, 753, 831, 348, 74,  893, 468, 240, 161, 151,
        756, 173, 742, 885, 217, 423, 949, 728, 463, 404, 110, 715, 893, 710,
        581, 372, 767, 945, 174, 286, 693, 954, 39,  524, 303, 465, 769, 771,
        58,  282, 923, 814, 455, 17,  51,  673, 440, 0,   753, 903, 756, 863,
        970, 650, 574, 903, 22,  341, 848, 548, 627, 893, 503, 18,  417, 806,
        836, 539, 929, 894, 821, 204, 60,  629, 221, 111, 302, 13,  463, 55,
        268, 220, 270, 239, 870, 844, 142, 244, 538, 343, 792, 165, 236, 295,
        536, 6,   453, 372, 545, 383, 618, 718, 587, 678, 347, 161, 141, 649,
        174, 604, 56,  443, 176, 327, 34,  46,  523, 176, 642, 61,  871, 435,
        227, 108, 82,  115, 114, 888, 839, 11,  623, 457, 729, 210, 487, 77,
        723, 628, 78,  898, 584, 487, 693, 761, 166, 727, 159, 689, 255, 802,
        751, 127, 237, 330, 587, 671, 445, 701, 559, 284, 712, 182, 93,  793,
        745, 580, 870, 468, 560, 301, 718, 144, 788, 411, 905, 954, 490, 65,
        995, 98,  867, 746, 225, 456, 76,  812, 127, 873, 865, 39,  509, 929,
        221, 602, 722, 318, 534, 945, 787, 94,  246, 857, 239, 386, 621, 496,
        692, 111, 913, 687, 209, 780, 434, 786, 588, 862, 950, 68,  88,  815,
        107, 597, 744, 680, 552, 819, 999, 438, 764, 786, 533, 10,  995, 124,
        748, 616, 972, 440, 80,  886, 127, 289, 18,  913, 428, 607, 776, 378,
        675, 216, 194, 134, 165, 290, 814, 717, 109, 813, 508, 873, 951, 41,
        235, 947, 517, 983, 915, 489, 423, 995, 727, 903, 285, 746};
    int size = sizeof(arr) / sizeof(arr[0]);
    printf("Unsorted array: \n");
    printArray(arr, size);
    printf("\n");
    printf("Array length: %d\n", size);

    if (argc < 3) {
      printf("Usage: %s sort <sorting_algorithm>\n", argv[0]);
      printf("Available sorting algorithms: bubble, heap, insertion, "
             "selection, merge, quick\n");
      return 1;
    }

    char *sortingAlgorithm = argv[2];

    clock_t start_time = clock();
    if (strcmp(sortingAlgorithm, "bubble") == 0) {
      printf("\nUsing bubble sort: \n");
      bubbleSort(arr, size);
    } else if (strcmp(sortingAlgorithm, "insertion") == 0) {
      printf("\nUsing insertion sort: \n");
      insertionSort(arr, size);
    } else if (strcmp(sortingAlgorithm, "selection") == 0) {
      printf("\nUsing selection sort: \n");
      selectionSort(arr, size);
    } else if (strcmp(sortingAlgorithm, "heap") == 0) {
      printf("\nUsing heap sort, heapifying first..\n");
      heapSort(arr, size);
    } else if (strcmp(sortingAlgorithm, "merge") == 0) {
      printf("\nUsing merge sort: \n");
      mergeSort(arr, 0, size - 1);
    } else if (strcmp(sortingAlgorithm, "quick") == 0) {
      printf("\nUsing quick sort: \n");
      quickSort(arr, 0, size - 1);
    } else {
      printf("Unknown sorting algorithms: %s\n", sortingAlgorithm);
      return 1;
    }

    clock_t end_time = clock();

    double time_taken =
        ((double)(end_time - start_time)) / CLOCKS_PER_SEC * 1000;
    printf("Sorted array: \n");
    printArray(arr, size);
    printf("\n");
    printf("Time taken: %f\n", time_taken);
  } else if (strcmp(argv[1], "linkedlist") == 0) {
    struct Node *head = NULL;

    appendNode(&head, 1);
    appendNode(&head, 2);
    appendNode(&head, 3);

    printf("Linked List: ");
    printLinkedList(head);

    return 0;

  } else {
    printf("Unknown command: %s\n", argv[1]);
    printf("Usage: %s <command> [options]\n", argv[0]);
    printf("Commands: stack, bags, queue, sort, linkedlist\n");
    return 1;
  }

  return 0;
}
